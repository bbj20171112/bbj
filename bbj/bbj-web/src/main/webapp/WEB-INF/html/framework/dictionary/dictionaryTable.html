<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>数据字典</title>

<!-- 引入全局css样式 -->
<script src="../../resources/framework/css-import.js"></script>

</head>
<body>
	<div class="wrapper">
		<h3 class="box-title">数据字典</h3>
		<section class="content">
			<div class="row">
				<div class="col-xs-12">
					<div class="box">
						<div class="box-header">
							<h3 class="box-title">基本表格</h3>
							<button type="button" onclick="showSelectItems()"
								class="btn btn-info">查看选中</button>
							<button type="button" onclick="newTable()" class="btn btn-info">新建</button>
							
						</div>
						<!-- /.box-header -->
						<div class="box-body">
							<table id="example" class="table table-bordered table-hover">
							</table>
						</div>
						<!-- /.box-body -->
					</div>
					<!-- /.col -->
				</div>
				<!-- /.row -->
		</section>
		<!-- /.content -->
	</div>
	</div>
	
	<div class="modal fade" id="modal-new-table" style="display: none;">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
					<h4 class="modal-title"><span class="pull-left header"><i class="fa fa-inbox"></i>
								表维护</span></h4>
				</div>
				<div class="modal-body">
					<div class="nav-tabs-custom">
						<!-- Tabs within a box -->
						<ul class="nav nav-tabs pull-right ui-sortable-handle">
							<li class=""><a href="#revenue-chart" data-toggle="tab"
								aria-expanded="false">SQL 预览</a></li>
							<li class="active"><a href="#field-columns"
								data-toggle="tab" aria-expanded="true">表 新增</a></li>
						</ul>
						<div class="tab-content no-padding">
							<!-- Morris chart - Sales -->
							<div class="chart tab-pane" id="revenue-chart"
								style="position: relative; height: 300px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
								SQL</div>
							<div class="chart tab-pane active" id="field-columns"
								style="position: relative; height: 300px;">
								<div class="form-horizontal">
									<div class="box-body">
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>表ID</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-table-id"></input>
											</div>
										</div>
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>表名称</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-table-name"></input>
											</div>
											<div class="col-sm-2 item">
												<label>表说明</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-table-comment"></input>
											</div>
										</div>
										<div class="row form-group">											
											<div class="col-sm-2 item">
												<label>表描述</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-table-description"></input>
											</div>
											<div class="col-sm-2 item">
												<label>序列</label>
											</div>
											<div class="col-sm-4 item">
												<select class="form-control select2"
													id="item-field-sequence-id" style="width: 100%">
													<option value="1" selected="selected">默认</option>
												</select>
											</div>
											
										</div>										
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>备注</label>
											</div>
											<div class="col-sm-10 item">
												<input class="form-control" id="item-field-table-remark"></input>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>


				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default pull-left"
						data-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary"
						onclick="newFieldSave()">Save</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	
	<!-- ./wrapper -->
	<!-- 引入JavaScripts样式 -->
	<script src="../../resources/framework/javascript-import.js"></script>

	<script type="text/javascript">
	$(function () {
		        	var headers = [];
					headers.push("ID");
					headers.push("表名称");
					headers.push("表说明");
					headers.push("表描述");
					headers.push("序列");
					headers.push("备注");
					headers.push("操作");
		        	// console.log(data);
		        	var tableExp = $('#example').DataTable({
		        		ajax: {
		                    url: contextPath + "/base/dictionary/table/queryByPage"
		                },
	      		columnDefs: [{
	             			targets: -1,
	                      render: function(data, type, row) {
	                      	var operatorDiv = '<div class="btn-group">'
	                      	+'<button type="button" onclick="row_edit(\''+row.attr.id+'\')" class="btn btn-info">编辑</button>'
	                      	+'<button type="button" onclick="row_delete(\''+row.attr.id+'\')" class="btn btn-danger">删除</button>'
	                      	+'<button type="button" onclick="row_edit_field(\''+row.attr.id+'\')" class="btn btn-info">字段维护</button>'
							+'</div>';
	                      	return operatorDiv;
	                     }
	                  }],
	      		columns: [ // 配置列映射（对象数据[嵌套数据：attr.id]）,如果是数组数据,直接 0,1,2,3 
	      			{ data: 'attr.id' , title: headers[0]},
					{ data: 'attr.table_name', title: headers[1]},
					{ data: 'attr.table_comment', title: headers[2]},
					{ data: 'attr.table_description', title: headers[3]},
					{ data: 'attr.sequence_id', title: headers[4]},
					{ data: 'attr.table_remark', title: headers[5]},
					{ data: null , title: headers[6]}, 
	              ]
	      	});
	  });
	 	
		// 获取选中
	    function showSelectItems() {
		$('#example').DataTable().ajax.reload();
	        /* console.log( $('#example').DataTable().rows('.selected').data()[0]);
	    	alert( $('#example').DataTable().rows('.selected').data().length +' row(s) selected' );*/
		}
	
		function row_edit(id){
			Utils.ajax({
		        url: contextPath + "/base/dictionary/table/queryById?id="+id,
		        success: function(data){
		        	data = data.data.attr;
					$("#item-field-table-id").val(data.id);
		        	$("#item-field-table-name").val(data.table_name);
					$("#item-field-table-comment").val(data.table_comment);
					$("#item-field-table-description").val(data.table_description);
					$("#item-field-sequence-id").val(data.sequence_id);
					
					$("#item-field-table-remark").val(data.table_remark);
					

					$("#modal-new-table").modal('show');
				}
			});
		}
		
		function row_delete(id){
			Utils.ajax({
		        url: contextPath + "/base/dictionary/table/deleteById?id="+id,
		        success: function(data){
		        	$('#example').DataTable().ajax.reload();
				}
			});
		}
		
		function row_edit_field(id){
			location.href = contextPath + "/base/dictionary/field/page?id=" +id ;
		}
		
		
		function newTable(){
			var data = {};
			$("#item-field-table-id").val(data.id);
        	$("#item-field-table-name").val(data.table_name);
			$("#item-field-table-comment").val(data.table_comment);
			$("#item-field-table-description").val(data.table_description);
			$("#item-field-sequence-id").val(data.sequence_id);
			
			$("#item-field-table-remark").val(data.table_remark);
			$("#modal-new-table").modal('show');
		}

		function newFieldSave(){
			var jsonData= {};
			jsonData.id = 0;
			jsonData.table_id = $("#item-field-table-id").val();
			jsonData.table_name = $("#item-field-table-name").val();
			jsonData.table_comment = $("#item-field-table-comment").val();
			jsonData.table_description = $("#item-field-table-description").val();
			jsonData.sequence_id = $("#item-field-sequence-id").val();
			
			jsonData.table_remark = $("#item-field-table-remark").val();
			
			console.log(jsonData.table_id);
			$("#modal-new-table").modal('hide');
			var url = contextPath + "/base/dictionary/table/insert";
			if(jsonData.table_id != ""){
				url = contextPath + "/base/dictionary/table/update";
			}
			Utils.ajax({
				type: "POST",
		        url: url,
		        data: jsonData,
		        success: function(data){
		        	$('#example').DataTable().ajax.reload();
				}
			});
		}
		
		function getSql(){
			
		}
		
		
	</script>
</body>
</html>