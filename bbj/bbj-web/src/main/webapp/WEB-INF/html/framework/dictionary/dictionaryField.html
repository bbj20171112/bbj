﻿
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>数据字典</title>

<!-- 引入全局css样式 -->
<script src="../../../resources/framework/css-import.js"></script>

</head>
<body>
	<div class="wrapper">
		<span class="white-text" th:text="${session.fieldObject}"></span>

		<h3 class="box-title">字段维护</h3>
		<section class="content">
			<div class="row">
				<div class="col-xs-12">
					<div class="box">
						<div class="box-header">
							<h3 class="box-title">基本表格</h3>
							<button type="button" onclick="showSelectItems()"
								class="btn btn-info">查看选中</button>
							<button type="button" onclick="newField()" class="btn btn-info">新建</button>
						</div>
						<!-- /.box-header -->
						<div class="box-body">
							<table id="example" class="table table-bordered table-hover">
							</table>
						</div>
						<!-- /.box-body -->
					</div>
					<!-- /.col -->
				</div>
				<!-- /.row -->
		</section>
		<!-- /.content -->
	</div>
	</div>

	<div class="modal fade" id="modal-new-field" style="display: none;">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
					<h4 class="modal-title">New</h4>
				</div>
				<div class="modal-body">
					<div class="nav-tabs-custom">
						<!-- Tabs within a box -->
						<ul class="nav nav-tabs pull-right ui-sortable-handle">
							<li class=""><a href="#revenue-chart" data-toggle="tab"
								aria-expanded="false">SQL 预览</a></li>
							<li class="active"><a href="#field-columns"
								data-toggle="tab" aria-expanded="true">列 新增</a></li>
							<li class="pull-left header"><i class="fa fa-inbox"></i>
								字段维护</li>
						</ul>
						<div class="tab-content no-padding">
							<!-- Morris chart - Sales -->
							<div class="chart tab-pane" id="revenue-chart"
								style="position: relative; height: 300px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
								SQL</div>
							<div class="chart tab-pane active" id="field-columns">
								<div class="form-horizontal">
									<div class="box-body">
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>ID</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-id" />
											</div>
										</div>
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>表ID</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-table_id"
													th:value="${param.id}" />
											</div>
										</div>
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>字段名称</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-field_name"></input>
											</div>
											<div class="col-sm-2 item">
												<label>字段说明</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control"
													id="item-field-field_name_comment"></input>
											</div>
										</div>
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>字段类型</label>
											</div>
											<div class="col-sm-4 item">
												<select class="form-control select2"
													id="item-field-field_key_type" style="width: 100%">
													<option value="1" selected="selected">字符串[varchar(64)]</option>
													<option value="2">数字[int]</option>
													<option value="3">长数字[float]</option>
													<option value="4">小数[decimal]</option>
													<option value="5">日期[date]</option>
													<option value="6">日期时间[datetime]</option>
													<option value="7">文本[text]</option>
													<option value="8">blob[blob]</option>
												</select>
											</div>
											<div class="col-sm-2 item">
												<label>字段描述</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control"
													id="item-field-field_key_type_comment"></input>
											</div>
										</div>
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>键值</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-field-key"></input>
											</div>
											<div class="col-sm-2 item">
												<label>键值说明</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-field-keycomm"></input>
											</div>
										</div>
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>约束</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-field_constraint"></input>
											</div>
											<div class="col-sm-2 item">
												<label>约束说明</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control"
													id="item-field-field_constraint_comment"></input>
											</div>
										</div>
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>参照</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control" id="item-field-field_reference"></input>
											</div>
											<div class="col-sm-2 item">
												<label>参照说明</label>
											</div>
											<div class="col-sm-4 item">
												<input class="form-control"
													id="item-field-field_reference_comment"></input>
											</div>
										</div>
										<div class="row form-group">
											<div class="col-sm-2 item">
												<label>备注</label>
											</div>
											<div class="col-sm-10 item">
												<input class="form-control" id="item-field-field_remark"></input>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>


				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default pull-left"
						data-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary"
						onclick="newFieldSave()">Save</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>

	<!-- ./wrapper -->
	<!-- 引入JavaScripts样式 -->
	<script src="../../../resources/framework/javascript-import.js"></script>
	<script type="text/javascript">
	$(function() {
		var headers = [];
		headers.push("ID");
		headers.push("字段名称");
		headers.push("字段类型");
		headers.push("字段说明");
		headers.push("字段描述");
		headers.push("键值");
		headers.push("键值说明");
		headers.push("约束");
		headers.push("约束说明");
		headers.push("参照");
		headers.push("参照说明");
		headers.push("备注");
		headers.push("操作");
		// console.log(data);
		var tableExp = $('#example')
				.DataTable(
						{
							ajax : {
								url : contextPath
										+ "/base/dictionary/field",
								data : function ( searchParam ) {  
					                //添加额外的参数传给服务器  
					                searchParam.table_id = $("#item-field-table_id").val();
					            }
							},
							columnDefs : [ {
								targets : -1,
								render : function(data, type, row) {
									var operatorDiv = '<div class="btn-group">'
											+ '<button type="button" onclick="row_editaaaa(\''
											+ row.attr.id
											+ '\')" class="btn btn-info">编辑</button>'
											+ '<button type="button" onclick="row_delete(\''
											+ row.attr.id
											+ '\')" class="btn btn-danger">删除</button>'
											+ '</div>';
									return operatorDiv;
								}
							} ],
							columns : [ // 配置列映射（对象数据[嵌套数据：attr.id]）,如果是数组数据,直接 0,1,2,3 
							{
								data : 'attr.id',
								title : headers[0]
							}, {
								data : 'attr.field_name',
								title : headers[1]
							}, {
								data : 'attr.field_key_type',
								title : headers[2]
							}, {
								data : 'attr.field_name_comment',
								title : headers[3]
							}, {
								data : 'attr.field_key_type',
								title : headers[4]
							}, {
								data : 'attr.field_reference',
								title : headers[5]
							}, {
								data : 'attr.field_constraint_comment',
								title : headers[6]
							},
							/* { data: 'field_cons', title: headers[7]},
							{ data: 'field_consdesc', title: headers[8]},
							{ data: 'field_ref', title: headers[9]},
							{ data: 'field_refdesc', title: headers[10]},
							{ data: 'field_remark', title: headers[11]}, */
							{
								data : null,
								title : headers[12]
							}, ]
						});
	});

	// 获取选中
	function showSelectItems() {
		console.log( $('#example').DataTable().rows('.selected').data()[0]);
	}

	function row_editaaaa(id) {
		var ss = "";
		Utils.ajax({
			url : contextPath + "/base/dictionary/field/" + id,
			type : 'GET',
			success : function(data) {
				data = data.data.attr;
				
				$("#item-field-id").val(data.id);
				//$("#item-field-table_id").val(data.table_id);
				$("#item-field-field_name").val(data.field_name);
				$("#item-field-field_name_comment").val(
						data.field_name_comment);
				$("#item-field-field_key_type").val(data.field_key_type);

				$("#item-field-field_key_type_comment").val(
						data.field_key_type_comment);
				$("#item-field-field_constraint")
						.val(data.field_constraint);
				$("#item-field-field_constraint_comment").val(
						data.field_constraint_comment);
				$("#item-field-field_reference").val(data.field_reference);
				$("#item-field-field_reference_comment").val(
						data.field_reference_comment);
				$("#item-field-field_remark").val(data.field_remark);

				$("#modal-new-field").modal('show');
			}
		});
	}

	function row_delete(id) {
		Utils.ajax({
			url : contextPath + "/base/dictionary/field/" + id,
			type : 'DELETE',
			success : function(data) {
				$('#example').DataTable().ajax.reload();
			}
		});
	}

	function newField() {
		var data = {};
		
		$("#item-field-id").val(data.id);
		//$("#item-field-table_id").val(data.table_id);
		$("#item-field-field_name").val(data.field_name);
		$("#item-field-field_name_comment").val(
				data.field_name_comment);
		$("#item-field-field_key_type").val(data.field_key_type);

		$("#item-field-field_key_type_comment").val(
				data.field_key_type_comment);
		$("#item-field-field_constraint")
				.val(data.field_constraint);
		$("#item-field-field_constraint_comment").val(
				data.field_constraint_comment);
		$("#item-field-field_reference").val(data.field_reference);
		$("#item-field-field_reference_comment").val(
				data.field_reference_comment);
		$("#item-field-field_remark").val(data.field_remark);
		
		$("#modal-new-field").modal('show');
	}

	function newFieldSave() {
		var jsonData = {};
		jsonData.id = $("#item-field-id").val();
		jsonData.table_id = $("#item-field-table_id").val();
		jsonData.field_name = $("#item-field-field_name").val();
		jsonData.field_name_comment = $("#item-field-field_name_comment")
				.val();
		jsonData.field_key_type = $("#item-field-field_key_type").val();

		jsonData.field_key_type_comment = $(
				"#item-field-field_key_type_comment").val();
		jsonData.field_constraint = $("#item-field-field_constraint").val();
		jsonData.field_constraint_comment = $(
				"#item-field-field_constraint_comment").val();
		jsonData.field_reference = $("#item-field-field_reference").val();
		jsonData.field_reference_comment = $(
				"#item-field-field_reference_comment").val();
		jsonData.field_remark = $("#item-field-field_remark").val();

		$("#modal-new-field").modal('hide');
		console.log("jsonData.id::" + jsonData.id);
		if (jsonData.id) {
			var url = contextPath + "/base/dictionary/field";
			Utils.ajax({
				type : "PUT",
				url : url,
				data : jsonData,
				success : function(data) {
					$('#example').DataTable().ajax.reload();
				}
			});
		} else {
			var url = contextPath + "/base/dictionary/field";
			Utils.ajax({
				type : "POST",
				url : url,
				data : jsonData,
				success : function(data) {
					$('#example').DataTable().ajax.reload();
				}
			});
		}

	}
	</script>

</body>
</html>